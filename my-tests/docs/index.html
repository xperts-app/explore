<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f0f4f9; margin:0; }
    .container { max-width:400px; margin:10vh auto; background:#fff; padding:30px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.05); }
    h2 { margin-top:0; }
    .input-group { margin-bottom:20px; }
    label { display:block; font-weight:500; margin-bottom:6px; }
    input { width:100%; padding:12px; border:1px solid #ccc; border-radius:8px; }
    button { width:100%; padding:14px; background:#0066ff; color:#fff; border:none; border-radius:8px; font-size:16px; cursor:pointer; }
    button:disabled { background:#a0cffd; cursor:not-allowed; }
    .error { color:#dc3545; margin-top:10px; min-height:20px; }
  </style>
</head>
<body>
  <div class="container" id="login-box">
    <h2>Welcome Back</h2>
    <p>Sign in with your mobile number</p>

    <div class="input-group">
      <label for="mobile">Mobile Number</label>
      <input type="tel" id="mobile" maxlength="10" placeholder="10-digit number">
    </div>

    <div id="password-container" style="display:none;">
      <div class="input-group">
        <label for="password">Password</label>
        <input type="password" id="password" placeholder="Enter password">
      </div>
    </div>

    <button id="submit-btn">Continue</button>
    <p class="error" id="error-msg"></p>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBnkCh8r_Ewx8lbr0RBB7i6M-xdABphd9w",
      authDomain: "initialisation-cfb78.firebaseapp.com",
      projectId: "initialisation-cfb78",
      storageBucket: "initialisation-cfb78.firebasestorage.app",
      messagingSenderId: "217554560023",
      appId: "1:217554560023:web:5ca34ac80acd8aba872852",
      measurementId: "G-S9T0PWGZQX"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Auto redirect if already logged in
    if (localStorage.getItem('loggedInUserId')) {
      window.location.href = "2.html";
    }

    const mobileInput = document.getElementById('mobile');
    const passwordContainer = document.getElementById('password-container');
    const passwordInput = document.getElementById('password');
    const submitBtn = document.getElementById('submit-btn');
    const errorMsg = document.getElementById('error-msg');

    let userData = null;
    let isLoginStep = false;

    submitBtn.addEventListener('click', async () => {
      errorMsg.textContent = '';
      submitBtn.disabled = true;

      const mobile = mobileInput.value.trim();
      if (!/^\d{10}$/.test(mobile)) {
        errorMsg.textContent = 'Enter a valid 10-digit number.';
        submitBtn.disabled = false; return;
      }

      if (!isLoginStep) {
        const snapshot = await db.collection('users').where('mobileNumber','==',mobile).get();
        if (snapshot.empty) {
          errorMsg.textContent = 'No account found.';
          submitBtn.disabled = false; return;
        }
        snapshot.forEach(doc => userData = { id: doc.id, ...doc.data() });
        isLoginStep = true;
        mobileInput.disabled = true;
        passwordContainer.style.display = 'block';
        submitBtn.textContent = 'Sign In';
        submitBtn.disabled = false;
      } else {
        const password = passwordInput.value;
        if (!password) { errorMsg.textContent = 'Password required.'; submitBtn.disabled = false; return; }
        if (userData.password !== password) { errorMsg.textContent = 'Incorrect password.'; submitBtn.disabled = false; return; }

        // Save session
        localStorage.setItem('loggedInUserId', userData.id);
        localStorage.setItem('loggedInUserClass', userData.class);

        window.location.href = "2.html"; // go to documents page
      }
    });
  </script>
</body>
</html>
