<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Viewer â€” Media</title>
<style>
  body{
    margin:0;
    background:#000;
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    align-items:center;
    gap:12px;
    padding:20px;
  }
  img, video{
    width:370px;
    height:500px;
    object-fit:cover;
    display:block;
    background:#000;
  }
  video{
    pointer-events:none; /* disable clicks/controls */
  }
</style>
</head>
<body>
  <div id="grid"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script>
  const firebaseConfig = {
    apiKey: "AIzaSyD-ers6CRuH8bCFomXJHuLxPWff-Xa4ZVk",
    authDomain: "xperts-data.firebaseapp.com",
    projectId: "xperts-data",
    storageBucket: "xperts-data.firebasestorage.app",
    messagingSenderId: "934675149024",
    appId: "1:934675149024:web:23486a5f38f65f103ce085",
    measurementId: "G-6TS06NTDZQ"
  };
  firebase.initializeApp(firebaseConfig);
  const db=firebase.firestore();
  const SLOTS_COLLECTION="slots";
  const MAX_SLOTS=7;
  const grid=document.getElementById("grid");

  // --- URL params ---
  const params=new URLSearchParams(window.location.search);
  const slotFilter=params.get("slot");   // e.g. ?slot=3
  const typeFilter=params.get("type");   // e.g. ?type=video or ?type=image

  function render(docs){
    grid.innerHTML="";
    docs.forEach((doc)=>{
      if(doc.exists){
        const data=doc.data();
        if(!data.url) return;

        // filter type
        const isVideo=data.url.toLowerCase().endsWith(".mp4");
        if(typeFilter==="video" && !isVideo) return;
        if(typeFilter==="image" && isVideo) return;

        if(isVideo){
          const video=document.createElement("video");
          video.src=data.url;
          video.autoplay=true;
          video.muted=true;
          video.loop=true;
          grid.appendChild(video);
        }else{
          const img=document.createElement("img");
          img.src=data.url;
          img.onerror=()=>{ img.remove(); };
          grid.appendChild(img);
        }
      }
    });
  }

  async function loadAll(){
    let promises=[];
    if(slotFilter){ // only one slot
      promises.push(db.collection(SLOTS_COLLECTION).doc(String(slotFilter)).get());
    }else{ // all slots
      for(let i=1;i<=MAX_SLOTS;i++){
        promises.push(db.collection(SLOTS_COLLECTION).doc(String(i)).get());
      }
    }
    const docs=await Promise.all(promises);
    render(docs);
  }

  // Real-time updates
  if(slotFilter){
    db.collection(SLOTS_COLLECTION).doc(String(slotFilter)).onSnapshot(loadAll);
  }else{
    for(let i=1;i<=MAX_SLOTS;i++){
      db.collection(SLOTS_COLLECTION).doc(String(i)).onSnapshot(loadAll);
    }
  }
  loadAll();
  </script>
</body>
</html>
